{
  "version": "1.0.0",
  "description": "Field mappings from Docling JSON extract to XLSX template cells",
  "template_name": "Serafina UW Phoenix AZ Feb 14 2025",
  "json_root": "structured_data[0]",
  
  "sheets": {
    "Property Summary": {
      "description": "Basic property information from CoStar report",
      "mappings": [
        {
          "cell": "C6",
          "label": "Property Name",
          "json_path": "property.name",
          "fallback_path": "sections_raw[0].content[0]",
          "fallback_transform": "extract_property_name",
          "type": "text",
          "source": "pdf_extract"
        },
        {
          "cell": "C7",
          "label": "Street Address",
          "json_path": "property.address",
          "fallback_path": "sections_raw[0].header",
          "type": "text",
          "source": "pdf_extract"
        },
        {
          "cell": "C8",
          "label": "City",
          "json_path": "property.city",
          "fallback_path": "sections_raw[0].content[1]",
          "fallback_transform": "extract_city",
          "type": "text",
          "source": "pdf_extract"
        },
        {
          "cell": "C9",
          "label": "State",
          "json_path": "property.state",
          "fallback_path": "sections_raw[0].content[1]",
          "fallback_transform": "extract_state_abbrev",
          "type": "text",
          "source": "pdf_extract"
        },
        {
          "cell": "F6",
          "label": "Total Units",
          "json_path": "property.no_of_units",
          "type": "number",
          "source": "pdf_extract"
        },
        {
          "cell": "F7",
          "label": "Avg Unit Size",
          "json_path": "property.avg_unit_size",
          "type": "number",
          "source": "pdf_extract"
        },
        {
          "cell": "F8",
          "label": "Current Vacancy",
          "json_path": "vacancy.current.rate",
          "type": "percentage",
          "transform": "divide_by_100",
          "source": "pdf_extract",
          "notes": "CoStar provides as whole number (6.0), template expects decimal (0.06)"
        },
        {
          "cell": "F10",
          "label": "Floors",
          "json_path": "property.stories",
          "type": "number",
          "source": "pdf_extract"
        },
        {
          "cell": "C13",
          "label": "Year Built",
          "json_path": "property.year_built",
          "type": "number",
          "source": "pdf_extract"
        },
        {
          "cell": "C16",
          "label": "Management Company",
          "json_path": "property_manager.name",
          "type": "text",
          "source": "pdf_extract"
        },
        {
          "cell": "C19",
          "label": "Seller Name",
          "json_path": "owner.name",
          "type": "text",
          "source": "pdf_extract"
        },
        {
          "cell": "C21",
          "label": "Last Sold Price",
          "json_path": "owner.purchase_price_raw",
          "type": "currency",
          "transform": "to_number",
          "source": "pdf_extract"
        },
        {
          "cell": "I6",
          "label": "Trailing 12 Revenue",
          "json_path": null,
          "type": "currency",
          "source": "external",
          "notes": "Not available in CoStar PDF, needs manual input"
        },
        {
          "cell": "I7",
          "label": "Trailing 12 Expenses",
          "json_path": null,
          "type": "currency",
          "source": "external",
          "notes": "Not available in CoStar PDF, needs manual input"
        },
        {
          "cell": "F9",
          "label": "Building(s)",
          "json_path": null,
          "type": "number",
          "source": "external",
          "notes": "Building count not in CoStar PDF"
        },
        {
          "cell": "I10",
          "label": "Guidance Price",
          "json_path": null,
          "type": "currency",
          "source": "external",
          "notes": "Deal-specific, not from CoStar"
        },
        {
          "cell": "C11",
          "label": "Zip Code",
          "json_path": null,
          "type": "number",
          "source": "external",
          "notes": "Can potentially extract from address"
        },
        {
          "cell": "C12",
          "label": "Land Area",
          "json_path": null,
          "type": "number",
          "source": "external",
          "notes": "Not in CoStar PDF"
        },
        {
          "cell": "C20",
          "label": "How Long Have They Owned?",
          "json_path": "owner.purchase_date",
          "type": "calculated",
          "transform": "years_since_purchase",
          "source": "pdf_extract",
          "notes": "Calculate from purchase date"
        }
      ]
    },
    
    "Unit Mix & Comps": {
      "description": "Unit breakdown data from CoStar report",
      "array_source": "unitBreakdown[0].rows",
      "row_start": 7,
      "max_rows": 30,
      "clear_before_fill": true,
      "clear_columns": ["B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L"],
      "mappings": [
        {
          "column": "B",
          "label": "Unit Type",
          "json_field": "_unit_type",
          "type": "text",
          "source": "pdf_extract",
          "transform": "bed_bath_label"
        },
        {
          "column": "C",
          "label": "Square Footage",
          "json_field": "avgSf",
          "type": "number",
          "source": "pdf_extract"
        },
        {
          "column": "D",
          "label": "Units",
          "json_field": "unitMix.units",
          "type": "number",
          "source": "pdf_extract"
        },
        {
          "column": "E",
          "label": "Occupied Units",
          "json_field": "_occupied_units",
          "type": "number",
          "source": "pdf_extract",
          "transform": "calc_occupied",
          "notes": "Calculate: total units - available units"
        },
        {
          "column": "G",
          "label": "Unit Mix Percentage",
          "json_field": "unitMix.mix%",
          "type": "percentage",
          "source": "pdf_extract"
        },
        {
          "column": "H",
          "label": "Current Advertised Rent",
          "json_field": "avgAskingRent.perUnit",
          "type": "currency",
          "source": "pdf_extract"
        },
        {
          "column": "J",
          "label": "Average Effective Rent",
          "json_field": "avgEffectiveRent.perUnit",
          "type": "currency",
          "source": "pdf_extract"
        }
      ],
      "unit_type_mapping": {
        "description": "Maps bed/bath combinations to template row offsets",
        "rows": [
          {"bed": 1, "bath": 1, "sf_range": [0, 700], "row_offset": 0, "template_label": "1 Bed- Classic"},
          {"bed": 1, "bath": 1, "sf_range": [700, 800], "row_offset": 1, "template_label": "1 Bed PU"},
          {"bed": 1, "bath": 1, "sf_range": [800, 1000], "row_offset": 2, "template_label": "1 Bed Reno"},
          {"bed": 2, "bath": 1, "sf_range": [800, 900], "row_offset": 3, "template_label": "2 Bed/1 Ba - Classic"},
          {"bed": 2, "bath": 2, "sf_range": [900, 1000], "row_offset": 4, "template_label": "2 Bed/2 Ba PU"},
          {"bed": 2, "bath": 2, "sf_range": [1000, 1100], "row_offset": 5, "template_label": "2 Bed/2 Ba Reno"}
        ]
      }
    },
    
    "Historical Financials": {
      "description": "Financial data - mostly external input needed",
      "mappings": [
        {
          "cell": "C10",
          "label": "Potential Rental Income",
          "json_path": null,
          "type": "currency",
          "source": "external",
          "notes": "From property financials, not CoStar"
        },
        {
          "cell": "C11",
          "label": "Loss to Lease",
          "json_path": null,
          "type": "currency",
          "source": "external"
        },
        {
          "cell": "C12",
          "label": "Vacancy Loss",
          "json_path": null,
          "type": "currency",
          "source": "external"
        }
      ]
    },
    
    "Demos": {
      "description": "Demographics data - external source",
      "mappings": [
        {
          "cell": "C6",
          "label": "Population (1 Mile)",
          "json_path": null,
          "type": "number",
          "source": "external",
          "notes": "Demographics not in CoStar property PDF"
        },
        {
          "cell": "D6",
          "label": "Population (3 Mile)",
          "json_path": null,
          "type": "number",
          "source": "external"
        },
        {
          "cell": "E6",
          "label": "Population (5 Mile)",
          "json_path": null,
          "type": "number",
          "source": "external"
        }
      ]
    }
  },
  
  "transforms": {
    "divide_by_100": {
      "description": "Convert percentage from whole number to decimal",
      "formula": "value / 100"
    },
    "to_number": {
      "description": "Convert string to number, removing formatting",
      "formula": "parseFloat(value.replace(/[^0-9.-]/g, ''))"
    },
    "years_since_purchase": {
      "description": "Calculate years from purchase date string like 'Purchased Mar 2019'",
      "formula": "Extract year and calculate difference from current year"
    }
  },
  
  "source_types": {
    "pdf_extract": {
      "description": "Data available from Docling PDF extraction",
      "auto_fill": true
    },
    "external": {
      "description": "Data NOT available from PDF, requires manual input or other source",
      "auto_fill": false,
      "highlight": true
    },
    "calculated": {
      "description": "Can be calculated from extracted data",
      "auto_fill": true
    }
  },
  
  "summary": {
    "total_mappable_fields": 6,
    "total_external_fields": 12,
    "sheets_with_mappings": ["Property Summary", "Unit Mix & Comps"],
    "primary_data_sources": {
      "property_info": "structured_data[0].property",
      "owner_info": "structured_data[0].owner", 
      "vacancy_info": "structured_data[0].vacancy",
      "rent_info": "structured_data[0].asking_rents",
      "unit_breakdown": "structured_data[0].unitBreakdown[1].rows"
    }
  }
}

